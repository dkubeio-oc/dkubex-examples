name: llama2

# Only shows `resources` as other fields do not change.
resources:
    cloud: aws  # Works as a default value for `cloud`.

    # Added only for SkyPilot Benchmark.
    candidates:
    - {accelerators: A10G:1}
    - {accelerators: V100:1}
    - {accelerators: T4}  # Overrides `cloud` to `aws`.

# Assume your working directory is under `~/transformers`.
# To make this example work, please run the following command:
# git clone https://github.com/huggingface/transformers.git ~/transformers -b v4.30.1
workdir: .

envs:
  CLOUDSDK_CORE_PROJECT: dkubex
  MLFLOW_TRACKING_URI: https://a1182e8440d4c4d138415baf0d11b362-62d15cf634758ebd.elb.us-west-2.amazonaws.com/api/mlflow/
  MLFLOW_TRACKING_INSECURE_TLS: "true"
  MLFLOW_EXPERIMENT_NAME: 'llama2_1'

setup: |
  conda create -n llama2 python=3.10 -y
  conda activate llama2
   pip install transformers==4.29.2 triton==2.0.0 sentencepiece==0.1.99 datasets==2.12.0 peft==0.3.0 torch==2.0.1 accelerate==0.19.0 safetensors==0.3.1 einops==0.6.1 wandb==0.15.3 bitsandbytes==0.39.0 scipy==1.11.1 mlflow==2.4.2 wget==3.2 fire==0.5.0 trl==0.7.1 boto3==1.28.47 ray==2.6.1 
run: |
  conda activate llama2
  python trainer.py
